<!DOCTYPE html>
<html>
<head>
  <title>Blockly with Stack Blocks</title>
  <script src="https://unpkg.com/blockly/blockly.min.js"></script>
  <script src="https://unpkg.com/blockly/msg/en.js"></script>
  <script src="https://unpkg.com/blockly/javascript.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/blockly/blockly.css">
  <style>
    body, html {
      margin: 0;
      height: 100%;
      overflow: hidden;
    }
    #blocklyDiv {
      height: 100%;
      width: 100%;
      position: absolute;
      top: 0;
      left: 0;
    }
    .control-button {
      position: absolute;
      right: 10px;
      z-index: 10;
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .control-button:hover {
      background-color: #45a049;
    }
    #runButton {
      top: 10px;
    }
    #alertButton {
      top: 60px;
    }
    #customAction {
      top: 110px;
    }
    #codeArea {
      display: none;
    }
  </style>
</head>
<body>
  <div id="blocklyDiv"></div>
  
  <!-- Run button -->
  <button id="runButton" class="control-button" onclick="runCode()">Run</button>
  
  <!-- Alert button -->
  <button id="alertButton" class="control-button" onclick="showAlert()">Alert</button>
  
  <!-- Custom Action block -->
  <button id="customAction" class="control-button" onclick="performCustomAction()">Custom Action</button>
  
  <!-- Element to display the generated code -->
  <pre id="codeArea"></pre>
  
  <xml id="toolbox" style="display: none">
    <!-- Logic category with if-else stack block -->
    <category name="Logic" colour="#5C81A6">
      <block type="controls_if"></block>
      <block type="controls_ifelse"></block>
    </category>
    <!-- Loops category with repeat and while loop stack blocks -->
    <category name="Loops" colour="#5CA65C">
      <block type="controls_repeat_ext">
        <value name="TIMES">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
      </block>
      <block type="controls_whileUntil"></block>
      <block type="controls_for">
        <value name="FROM">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="TO">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
        <value name="BY">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
      <block type="controls_forEach"></block>
      <block type="controls_flow_statements"></block>
    </category>
    <!-- Math category with some basic math blocks -->
    <category name="Math" colour="#5C68A6">
      <block type="math_number">
        <field name="NUM">0</field>
      </block>
      <block type="math_change">
        <value name="DELTA">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
    </category>
    <!-- Text category with basic text blocks -->
    <category name="Text" colour="#5CA68D">
      <block type="text_print"></block>
      <block type="text_append">
        <value name="TEXT">
          <shadow type="text"></shadow>
        </value>
      </block>
    </category>
    <!-- Variables category with variable blocks -->
    <category name="Variables" custom="VARIABLE" colour="#A65C81"></category>
    <!-- Functions category with function blocks -->
    <category name="Functions" custom="PROCEDURE" colour="#9A5CA6"></category>
    <!-- Custom blocks -->
    <category name="Custom" colour="#FF5733">
      <block type="alert_block"></block>
      <block type="custom_action"></block>
    </category>
  </xml>
  
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      var workspace = Blockly.inject('blocklyDiv', {
        toolbox: document.getElementById('toolbox')
      });
    });

    function runCode() {
      var workspace = Blockly.getMainWorkspace();
      var code = Blockly.JavaScript.workspaceToCode(workspace);
      document.getElementById('codeArea').textContent = code;
      try {
        eval(code);
      } catch (e) {
        console.error(e);
      }
    }

    function showAlert() {
      alert("Hello, world!");
    }

    function performCustomAction() {
      // Add your custom action here
      console.log("Custom action executed!");
    }

    Blockly.Blocks['custom_action'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("Custom Action");
        this.setPreviousStatement(true, null);
        this.setColour(230);
        this.setTooltip("");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['custom_action'] = function(block) {
      // Generate JavaScript code for custom action
      var code = 'performCustomAction();\n';
      return code;
    };
  </script>
</body>
</html>
